# NDL古文書自動翻刻ツール

国立国会図書館（NDL）の「新編武蔵風土記稿」を、Claude の Vision 能力を使って自動翻刻するツールです。

## 対象資料

**新編武蔵風土記稿**
- 出版社: 内務省地理局
- 出版年: 明治17年（1884年）
- 総ページ数: 114ページ
- NDL ID: 763978
- ライセンス: パブリックドメイン（PDM）

## セットアップ

### 1. 必要なライブラリのインストール

```bash
pip install anthropic
```

### 2. Anthropic API キーの設定

```bash
export ANTHROPIC_API_KEY="your-api-key-here"
```

または、`.env` ファイルを作成:
```
ANTHROPIC_API_KEY=your-api-key-here
```

## 使用方法

### 最初の5ページを翻刻

```bash
python3 transcribe_ndl.py
```

### カスタム範囲を翻刻

```bash
# ページ 1 〜 10 を翻刻
python3 transcribe_ndl.py 1 10

# ページ 50 〜 55 を翻刻
python3 transcribe_ndl.py 50 55
```

## 出力

翻刻結果は `transcription_output.txt` に保存されます。

```
===================================================
【ページ 1】
===================================================
[翻刻されたテキスト...]

===================================================
【ページ 2】
===================================================
[翻刻されたテキスト...]
```

## 翻刻の特徴

- **現代字体への統一**: 古い字体を読みやすい現代字体に変換
- **変体仮名の解釈**: ゐ→い、ゑ→え など、旧仮名遣いを現代遣いに
- **句点の挿入**: 元のテキストに適切な句読点を追加
- **レイアウト保持**: 元の行構成をできるだけ保持
- **不明な箇所の記録**: 読めない文字は【？】と記載

## 処理時間とコスト

- **1ページあたりの処理時間**: 約 5〜10 秒
- **API 呼び出し間隔**: 2秒（レート制限対策）
- **推定コスト**:
  - 5ページ: 約 $0.05〜0.10
  - 50ページ: 約 $0.50〜1.00
  - 全114ページ: 約 $1.00〜2.00

## トラブルシューティング

### API キーが見つからない

```
Error: Anthropic API key not found
```

→ `ANTHROPIC_API_KEY` が設定されていることを確認してください

### ダウンロード失敗

```
✗ ダウンロード失敗: HTTP Error 403
```

→ NDL のサーバーが一時的に利用不可の可能性があります。しばらく待ってから再実行してください

### メモリ不足

大量ページを一度に処理する場合は、範囲を分割して実行してください：

```bash
python3 transcribe_ndl.py 1 10    # 最初の10ページ
python3 transcribe_ndl.py 11 20   # 次の10ページ
```

## スクリプトのカスタマイズ

### 別の NDL 資料を翻刻

マニフェストの情報を変更してスクリプトを修正：

```python
MANIFEST_ID = "763978"  # NDL の資料ID
MANIFEST_TITLE = "新編武蔵風土記稿"
TOTAL_PAGES = 114  # 総ページ数
```

NDL ID は以下の URL から確認できます：
`https://dl.ndl.go.jp/info:ndljp/pid/763978`

### 翻刻指示の変更

`transcribe_page()` 関数内の prompt を編集して、翻刻スタイルをカスタマイズできます：

```python
"text": """
[翻刻の指示をここに記述]
"""
```

## 活用例

### ZINE や出版物への引用

翻刻した古文書を、「古典逃避マニュアル」などの企画に引用する場合：

1. 必要なページを翻刻
2. テキストファイルから該当部分をコピー
3. 必要に応じて手動で微調整
4. 出版物に組み込み

### 学術研究

地誌研究や江戸時代の武蔵国の歴史研究に活用：

1. テーマに関連するページを選定
2. 批判的に検証しながら翻刻結果を確認
3. 研究論文に参考資料として引用

### デジタルアーカイブ構築

複数の古文書を翻刻してデータベース化：

1. 複数資料を範囲指定で処理
2. 翻刻結果を CSV/JSON に整理
3. 検索可能なアーカイブとして公開

## ライセンスと引用

この資料はパブリックドメインですが、引用する際には以下を記載してください：

**引用例:**
> 『新編武蔵風土記稿』内務省地理局編、明治17年 (1884年)  
> 国立国会図書館デジタルコレクション (https://dl.ndl.go.jp/)

## 注意事項

- ⚠️ 翻刻結果は自動処理のため、100% 正確ではありません
- ⚠️ 重要な引用や研究利用の際は、**原本と照合**してください
- ⚠️ Claude API 利用にはクレジットカードが必要です
- ⚠️ 大量処理時は API レート制限に注意

## サポート

質問や問題がある場合：

1. エラーメッセージ全文を確認
2. NDL サイトで資料の可用性を確認
3. Anthropic API ドキュメントを参照

## 参考リンク

- [NDL デジタルコレクション](https://dl.ndl.go.jp/)
- [該当資料ページ](https://dl.ndl.go.jp/info:ndljp/pid/763978)
- [Anthropic API ドキュメント](https://docs.anthropic.com/)
- [Claude Vision ガイド](https://docs.anthropic.com/claude/reference/vision)
